<!DOCTYPE html>
<html lang="en">
<head>
	<title>voidlinux install | efym.net</title>
	<link rel="canonical" href="http://efym.net/">
	<link rel='alternate' type='application/rss+xml' title="efym.net RSS" href='/index.xml'>
	<link rel='stylesheet' type='text/css' href='/style.css'>
	<link rel="icon" href="/favicon.ico">
	<meta name="description" content="Notes on my Void Linux setup.">
	<meta name="keywords" content="linux">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="robots" content="index, follow">
	<meta charset="utf-8">
</head>
<body>
<div class="topbar">
<nav class="menu">
<div class="nav-left">
 <ul>
	<li><a href="/"><img class="logo" src="/svg/efym/net.svg" alt="logo"></a></li>
  </ul>
</div>
<div class="nav-right">
 <ul>
	<li><a href="/contact">üì† contact</a></li>
	<li><a href="/support">üí∏ support</a></li>
	<li><a href="/services">üñ•Ô∏è services</a></li>
	<li><a href="/blog">üìù blog</a></li>
	<li><a href="/about">üë§ about</a></li>
  </ul>
</div>
</nav>
</div>
<main>
<header><h1>Voidlinux Install</h1></header>
<article>
<p class="date">July 01, 2021</p>
<p>Notes on my Void Linux setup.</p>
<hr>
<p>Recently I switched the linux distribution I use on my desktop and laptop to Void from Arch. I had used Void before but switched away from it because there were some packages I use missing from their repositories. That point hasn&rsquo;t really changed much, but I thought I&rsquo;d give it another go anyway.</p>
<blockquote>
<p><strong>Note:</strong> There&rsquo;s a guide on the <a href="https://docs.voidlinux.org/installation/guides/fde.html">Void Linux docs</a> page about an installation with encrypted boot, I personally choose to leave my boot partition unencrypted because I think it&rsquo;s largely useless to do it; and also because the Grub bootloader doesn&rsquo;t support luks2 scheme so you&rsquo;re forced to use luks1 which I&rsquo;m uncomfortable with.</p>
</blockquote>
<p>I use an ISO keyboard with a uk layout, I&rsquo;m also a heavy vim user so a lot of of the desicions I make are personal preference, YMMV. Here&rsquo;s how I set it up:</p>
<p>Firstly boot the live iso image into the box you&rsquo;re doing the installation on (won&rsquo;t cover that since it&rsquo;s fairly obvious) and login as root.</p>
<h2 id="preparation">Preparation</h2>
<p>Sets TERM variable (especially useful if doing this through ssh) and vim mode for the shell</p>
<pre tabindex="0"><code>root@void-live:~ # export TERM=xterm-256color
</code></pre><pre tabindex="0"><code>root@void-live:~ # alias v=nvim
</code></pre><pre tabindex="0"><code>root@void-live:~ # set -o vi
</code></pre><pre tabindex="0"><code>root@void-live:~ # bind -m vi-command &#39;Control-l: clear-screen&#39;
</code></pre><pre tabindex="0"><code>root@void-live:~ # bind -m vi-insert &#39;Control-l: clear-screen&#39;
</code></pre><p>Change keycode 58 = Escape to make Caps Lock key act as Escape because it&rsquo;s $currentyear</p>
<pre tabindex="0"><code>root@void-live:~ # v /usr/share/kbd/keymaps/i386/qwerty/uk.map.gz
</code></pre><pre tabindex="0"><code>root@void-live:~ # loadkeys uk
</code></pre><p>Ping any website to check internet connection</p>
<pre tabindex="0"><code>root@void-live:~ # ping gnu.org
</code></pre><p>Check whether you&rsquo;re booted into uefi or bios</p>
<pre tabindex="0"><code>root@void-live:~ # ls /sys/firmware/efi/efivars
</code></pre><h2 id="partitions">Partitions</h2>
<p>Create 2 partitions on your drive (first one is just for /boot so I always make it 1GB, which is plenty). Encrypt the second one with LUKS</p>
<pre tabindex="0"><code>root@void-live:~ # fdisk /dev/sda
</code></pre><pre tabindex="0"><code>root@void-live:~ # cryptsetup luksFormat /dev/sda2
</code></pre><pre tabindex="0"><code>root@void-live:~ # cryptsetup luksOpen /dev/sda2 [NAMEOFcrypt]
</code></pre><p>LVM setup</p>
<pre tabindex="0"><code>root@void-live:~ # pvcreate /dev/mapper/[NAMEOFcrypt]
</code></pre><pre tabindex="0"><code>root@void-live:~ # vgcreate [NAMEOF-vg] /dev/mapper/[NAMEOFcrypt]
</code></pre><pre tabindex="0"><code>root@void-live:~ # lvcreate --name root -L 100G [NAMEOF-vg]
</code></pre><pre tabindex="0"><code>root@void-live:~ # lvcreate --name home -l 100%FREE [NAMEOF-vg]
</code></pre><p>Format the newly created partitions</p>
<pre tabindex="0"><code>root@void-live:~ # mkfs.vfat -F32 /dev/sda1
</code></pre><pre tabindex="0"><code>root@void-live:~ # mkfs.ext4 -L root /dev/[NAMEOF-vg]/root
</code></pre><pre tabindex="0"><code>root@void-live:~ # mkfs.ext4 -L home /dev/[NAMEOF-vg]/home
</code></pre><p>Mount the partitions</p>
<pre tabindex="0"><code>root@void-live:~ # mount /dev/[NAMEOF-vg]/root /mnt
</code></pre><pre tabindex="0"><code>root@void-live:~ # mkdir -p /mnt/{home,boot}
</code></pre><pre tabindex="0"><code>root@void-live:~ # mount /dev/[NAMEOF-vg]/home /mnt/home
</code></pre><pre tabindex="0"><code>root@void-live:~ # mount /dev/sda1 /mnt/boot
</code></pre><p>Mount dev proc sys and run in bind mode in order to chroot to /mnt</p>
<pre tabindex="0"><code>root@void-live:~ # for dir in dev proc sys run; do mkdir -p /mnt/$dir; mount --rbind /$dir /mnt/$dir; mount --make-rslave /mnt/$dir; done
</code></pre><h2 id="system-bootstrap-and-installation">System bootstrap and installation</h2>
<pre tabindex="0"><code>root@void-live:~ # xbps-install -Sy -R https://alpha.de.repo.voidlinux.org/current -r /mnt base-system base-devel cryptsetup lvm2 neovim openssh connman connman-ncurses dbus-elogind python3 openntpd grub-x86_64-efi
</code></pre><p>Chroot into <code>/mnt</code> and continue installation from there</p>
<pre tabindex="0"><code>root@void-live:~ # chroot /mnt bash
</code></pre><pre tabindex="0"><code>chroot # chown root:root /
</code></pre><pre tabindex="0"><code>chroot # chmod 755 /
</code></pre><pre tabindex="0"><code>chroot # echo [NAMEOFbox] &gt; /etc/hostname
</code></pre><p>Modify hosts file to reflect new hostname</p>
<pre tabindex="0"><code>chroot # v /etc/hosts
</code></pre><p>Set your timezone, keyboard (I replace Caps_Lock to act as Escape again by setting keycode 58 = Escape), keymap, and locale</p>
<pre tabindex="0"><code>chroot # ln -fs /usr/share/zoneinfo/Europe/London /etc/localtime
</code></pre><pre tabindex="0"><code>chroot # v /usr/share/kbd/keymaps/i386/qwerty/uk.map.gz
</code></pre><pre tabindex="0"><code>chroot # echo &#34;KEYMAP=uk&#34; &gt;&gt; /etc/rc.conf
</code></pre><pre tabindex="0"><code>chroot # echo &#34;LANG=en_GB.UTF-8&#34; &gt; /etc/locale.conf
</code></pre><pre tabindex="0"><code>chroot # echo &#34;en_GB.UTF-8 UTF-8&#34; &gt;&gt; /etc/default/libc-locales
</code></pre><pre tabindex="0"><code>chroot # xbps-reconfigure -f glibc-locales
</code></pre><h2 id="users-and-groups">Users and groups</h2>
<pre tabindex="0"><code>chroot # useradd -m -g wheel [NAMEOFuser]
</code></pre><pre tabindex="0"><code>chroot # groupadd libvirt
</code></pre><pre tabindex="0"><code>chroot # usermod -a -G audio,video,libvirt,lp [NAMEOFuser]
</code></pre><pre tabindex="0"><code>chroot # chown [NAMEOFuser]:wheel -R /home/[NAMEOFuser]
</code></pre><pre tabindex="0"><code>chroot # chmod 700 /home/[NAMEOFuser]
</code></pre><pre tabindex="0"><code>chroot # passwd [NAMEOFuser]
</code></pre><pre tabindex="0"><code>chroot # passwd root
</code></pre><h2 id="create-a-swapfile">Create a swapfile</h2>
<pre tabindex="0"><code>chroot # dd if=/dev/zero of=/var/swapfile count=8192 bs=1MiB
</code></pre><pre tabindex="0"><code>chroot # chmod 600 /var/swapfile
</code></pre><pre tabindex="0"><code>chroot # mkswap /var/swapfile 
</code></pre><pre tabindex="0"><code>chroot # swapon /var/swapfile
</code></pre><h2 id="edit-your-fstab">Edit your fstab</h2>
<p>Use this command to add the UUID of sda1 into the fstab file</p>
<pre tabindex="0"><code>chroot # blkid -o value -s UUID /dev/sda1 &gt;&gt; /etc/fstab
</code></pre><p>Your fstab should look like this</p>
<pre tabindex="0"><code>/dev/[NAMEOF-vg]/root       /        ext4      defaults         0       0
/dev/[NAMEOF-vg]/home       /home    ext4      defaults         0       0
UUID=[UUIDOFsda1]           /boot    vfat      defaults         0       0
/var/swapfile               swap     swap      none             0       0
</code></pre><h2 id="bootloader">Bootloader</h2>
<p>I use grub as my bootloader, feel free to use any alternatives you like here.</p>
<p>Use this command if running uefi</p>
<pre tabindex="0"><code>chroot # grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=&#34;Void&#34; /dev/sda
</code></pre><p>Use this one if running bios</p>
<pre tabindex="0"><code>chroot # grub-install --bootloader-id=&#34;Void&#34; /dev/sda
</code></pre><p>Use this command to add the UUID of the encrpyted partition /dev/sda2 into /etc/default/grub</p>
<pre tabindex="0"><code>chroot # blkid -o value -s UUID /dev/sda2 &gt;&gt; /etc/default/grub
</code></pre><p>Modify <code>/etc/default/grub</code> to look like the following (only need to change LINUX_DEFAULT line)</p>
<pre tabindex="0"><code>GRUB_CMDLINE_LINUX_DEFAULT=&#34;loglevel=3 rd.auto=1 cryptdevice=UUID=[UUIDOFsda2]&#34;
</code></pre><p>Update grub.cfg</p>
<pre tabindex="0"><code>chroot # grub-mkconfig -o /boot/grub/grub.cfg
</code></pre><h2 id="finalizing">Finalizing</h2>
<pre tabindex="0"><code>chroot # rm /var/service/agetty-{tty3,tty4,tty5,tty6}
</code></pre><pre tabindex="0"><code>chroot # ln -fs /etc/sv/{sshd,dbus,connmand,openntpd} /var/service/
</code></pre><pre tabindex="0"><code>chroot # echo &#34;%wheel ALL=(ALL) NOPASSWD: ALL&#34; &gt;&gt; /etc/sudoers.d/sudo-wheel
</code></pre><pre tabindex="0"><code>chroot # echo &#34;[NAMEOFuser] hard nofile 524288&#34; &gt;&gt; /etc/security/limits.conf
</code></pre><p>Exit chroot, unmount drives and reboot</p>
<pre tabindex="0"><code>chroot # exit
</code></pre><pre tabindex="0"><code>root@void-live:~ # umount -R /mn
</code></pre><pre tabindex="0"><code>root@void-live:~ # reboot
</code></pre><p>Right now you should have a fully functioning Void install, I use an Ansible playbook which sets up my entire graphical environment, dotfiles and other things; maybe I&rsquo;ll publish that soon.</p></article>
</main>
<footer>
<p>licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">cc by-nc-sa 4.0</a></br>
standing up for freedom </p>
</footer>
</body>
</html>

