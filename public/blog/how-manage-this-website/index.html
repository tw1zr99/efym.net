<!DOCTYPE html>
<html lang="en">
<head>
	<title>how i manage this website üåê | efym.net</title>
	<link rel="canonical" href="http://efym.net/">
	<link rel='alternate' type='application/rss+xml' title="efym.net RSS" href='/index.xml'>
	<link rel='stylesheet' type='text/css' href='/style.css'>
	<link rel="icon" href="/favicon.ico">
	<meta name="description" content="Run-down of the process and tools I use to keep efym.net running.">
	<meta name="keywords" content="html, bash">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="robots" content="index, follow">
	<meta charset="utf-8">
</head>
<body>
<div class="topbar">
<nav class="menu">
<div class="nav-left">
 <ul>
	<li><a href="/"><img class="logo" src="/svg/efym/net.svg" alt="logo"></a></li>
  </ul>
</div>
<div class="nav-right">
 <ul>
	<li><a href="/contact">üì† contact</a></li>
	<li><a href="/support">üí∏ support</a></li>
	<li><a href="https://home.efym.net">üñ•Ô∏è services</a></li>
	<li><a href="/blog">üìù blog</a></li>
	<li><a href="/about">üë§ about</a></li>
  </ul>
</div>
</nav>
</div>
<main>
<header><h1>How I manage this website üåê</h1></header>
<article>
<p class="date">October 29, 2021</p>
<p>Run-down of the process and tools I use to keep efym.net running.</p>
<hr>
<p class="date">August 25, 2022</p>
<h2 style="color: #a23333; text-decoration: none; margin-top:0; text-shadow: 1px 1px #000;">Update:</h2>
I no longer edit and deploy this website using this script, the post will remain around for archiving purposes.<br>
<b>efym.net</b> is currently built using <a href="https://gohugo.io">Hugo</a>.

<hr>
<h2 id="static-site-generation">Static site generation</h2>
<p>Back when I was around 10 years old one of my older cousins showed me how to make very simple web pages by writing the <strong>html</strong> tags directly into a file with notepad. Now many years later I still write my own <strong>html</strong> code instead of using frameworks, all I need is <strong>vim</strong> to make a website; granted it wouldn&rsquo;t be anywhere near as fancy of something produced with <strong>Wordpress</strong> or <strong>Joomla</strong> but to me that&rsquo;s a plus. I despise how bloated the modern web is which is why my website is kept intentionally simple.</p>
<p>All that being said, it would be a major pain in the ass and totally unnecesary to write every single web page from scratch by hand, so when I first created <strong>efym.net</strong> I looked around to make a choice about which static site generator I was going to use. Very much to my surprise I found <strong>ssg</strong>, a very simple script written in <strong>bash</strong> which does something very close to what I wanted: it takes a header and a footer file and wraps every other file in the designated directory with them. There are a couple other things it does but none of them really concern me. No bloat, no JavaScript, no themes, etc.</p>
<p>It supports <strong>markdown</strong> to <strong>html</strong> conversion too, so if one was inclined to write the pages in markdown one could do that. All you need to do to run it is make a couple of directories, one with source files and one which acts as the destination one, this last directory&rsquo;s content is ready to be put in your web server.</p>
<p>There are detailed instructions on <strong>ssg</strong>&rsquo;s website, which you can visit at:
<a href="https://www.romanzolotarev.com/ssg.html">https://www.romanzolotarev.com/ssg.html</a>
But as an example this is what I would run to generate the website files for the first time or after modifying something:</p>
<pre tabindex="0"><code>$ ssg6 src dst &#34;efym&#34; &#34;https://efym.net&#34;
</code></pre><p>Before I <strong>rsync</strong> the <strong>dst</strong> directory to the server which hosts my website I like to check everything is looking the way I want it, so I host a simple <strong>http</strong> server with a <strong>Python</strong> module right from the computer I&rsquo;m working on for testing purposes, this can be achieved by changing into the <strong>dst</strong> directory and issuing the following command:</p>
<pre tabindex="0"><code>$ python -m http.server 8080
</code></pre><p>Then just open any web browser and point the url to <strong>localhost:8080</strong>.</p>
<h2 id="deployment-script">Deployment script</h2>
<p>As good as <strong>ssg</strong> is as a static site generator, it&rsquo;s still missing some very specific things, I wanted a &ldquo;Recent articles&rdquo; section at the bottom of the <strong>index.html</strong> page which automatically selected the most recent 2-3 blog posts I&rsquo;d written and displayed links to them. I also wanted the <strong>blogindex.html</strong> page to be generated with entries linking to every blog post inside the <strong>blog</strong> directory. So in order to not have to add and change these entries manually everytime I write a new blog post, I wrote a wrapper script to take care of it, here is what it looks like:</p>
<p><strong><code>$ cat deploy-site</code></strong></p>
<pre tabindex="0"><code>#!/bin/bash

[[ -f ./deploy-site ]] || exit 1

posts=$(grep -m1 the_index src/blog/*.html | sort -g -r -k2 -t = | cut -d\: -f1 | cut -d\/ -f3)
posts_recents=$(grep -m1 the_index src/blog/*.html | sort -g -r -k2 -t = | cut -d\: -f1 | cut -d\/ -f3 | head -n3)

# generate/update blog entries in blogindex.html
echo &#34;&lt;center&gt;&lt;a href=&#39;/feed&#39; type=&#39;application/rss+xml&#39;&gt;&lt;img class=&#39;icon&#39; src=&#39;/img/rss_icon.png&#39;&gt; RSS feed&lt;/a&gt;&lt;/center&gt;&#34; &gt; src/blogindex.html
for post in ${posts}; do
	title=$(grep &#39;&lt;h1&gt;&#39; src/blog/$post | sed &#39;s|&lt;/*h1&gt;||g&#39;)
	desc=$(grep &#39;&lt;p class=&#34;desc&#34;&gt;&#39; src/blog/$post | sed &#39;s|&lt;/*p&gt;||g&#39; | sed &#39;s|&lt;p class=&#34;desc&#34;&gt;||g&#39;)
	datt=$(grep &#39;&lt;p class=&#34;date&#34;&gt;&#39; src/blog/$post | sed &#39;s|&lt;/*p&gt;||g&#39; | sed &#39;s|&lt;p class=&#34;date&#34;&gt;||g&#39;)
	echo &#34;&lt;p class=&#34;date&#34;&gt;$datt&lt;/p&gt;&#34; &gt;&gt; src/blogindex.html
	echo &#34;&lt;a href=&#34;blog/${post}&#34;&gt;$title&lt;/a&gt;&#34; &gt;&gt; src/blogindex.html
	echo &#34;&lt;p class=&#34;desc&#34;&gt;$desc&lt;/p&gt;&#34; &gt;&gt; src/blogindex.html
	echo &#34;&lt;hr&gt;&#34; &gt;&gt; src/blogindex.html
done

# generate/update rss feed
echo &#34;&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39;?&gt;&#34; &gt; src/feed
echo &#34;&lt;rss version=&#39;2.0&#39;&gt;&#34; &gt;&gt; src/feed
echo &#34;&lt;channel&gt;&#34; &gt;&gt; src/feed
echo &#34;&lt;title&gt;efym.net&lt;/title&gt;&#34; &gt;&gt; src/feed
echo &#34;&lt;description&gt;you can&#39;t escape from your mind&lt;/description&gt;&#34; &gt;&gt; src/feed
echo &#34;&lt;link&gt;https://efym.net&lt;/link&gt;&#34; &gt;&gt; src/feed
for post in ${posts}; do
	title=$(grep &#39;&lt;h1&gt;&#39; src/blog/$post | sed &#39;s|&lt;/*h1&gt;||g&#39;)
	desc=$(grep &#39;&lt;p class=&#34;desc&#34;&gt;&#39; src/blog/$post | sed &#39;s|&lt;/*p&gt;||g&#39; | sed &#39;s|&lt;p class=&#34;desc&#34;&gt;||g&#39;)
	datt=$(grep &#39;&lt;p class=&#34;date&#34;&gt;&#39; src/blog/$post | sed &#39;s|&lt;/*p&gt;||g&#39; | sed &#39;s|&lt;p class=&#34;date&#34;&gt;||g&#39;)
	rssdatt=$(date -R --date=&#34;$datt&#34;)
	echo &#34;&lt;item&gt;&#34; &gt;&gt; src/feed
	echo &#34;&lt;guid&gt;https://efym.net/blog/$post&lt;/guid&gt;&#34; &gt;&gt; src/feed
	echo &#34;&lt;link&gt;https://efym.net/blog/$post&lt;/link&gt;&#34; &gt;&gt; src/feed
	echo &#34;&lt;pubDate&gt;$rssdatt&lt;/pubDate&gt;&#34; &gt;&gt; src/feed
	echo &#34;&lt;title&gt;$title&lt;/title&gt;&#34; &gt;&gt; src/feed
	echo &#34;&lt;description&gt;$desc&lt;/description&gt;&#34; &gt;&gt; src/feed
	echo &#34;&lt;/item&gt;&#34; &gt;&gt; src/feed
done
echo &#34;&lt;/channel&gt;&#34; &gt;&gt; src/feed
echo &#34;&lt;/rss&gt;&#34; &gt;&gt; src/feed

# updates &#34;recent articles&#34; list of blog entries in index.html
sed -i &#39;1,/the_recents/!d&#39; src/index.html
for post in ${posts_recents}; do
	title=$(grep &#39;&lt;h1&gt;&#39; src/blog/$post | sed &#39;s|&lt;/*h1&gt;||g&#39;)
	echo &#34;&lt;li&gt;&lt;a href=&#39;/blog/${post}&#39;&gt;$title&lt;/a&gt;&lt;/li&gt;&#34; &gt;&gt; src/index.html
done
echo &#34;&lt;p&gt;&lt;/p&gt;&#34; &gt;&gt; src/index.html
echo &#34;&lt;a href=&#39;/feed&#39; type=&#39;application/rss+xml&#39;&gt;&lt;img class=&#39;icon&#39; src=&#39;/img/rss_icon.png&#39;&gt; RSS feed&lt;/a&gt;&lt;br&gt;&#34; &gt;&gt; src/index.html
echo &#34;&lt;/ul&gt;&#34; &gt;&gt; src/index.html

# ssg6 rebuild static pages
rm dst/.files
ssg6 src dst &#34;efym&#34; &#34;https://efym.net&#34;

# rsync everything to efym server
read -r -p &#34;deploy to efym.net server? [y/N] &#34; input
case $input in
	[yY][eE][sS]|[yY]) rsync -avhP --delete --chown=www-data:www-data ./dst/ root@efym.net:/var/www/efym.net/ ;;
	*) echo &#34;not deploying&#34; ;;
esac
</code></pre><p>The script has comments at the beginning of each section, so it should be fairly easy to identify exactly how I accomplish the tasks mentioned before (provided the reader is familiar with <strong>bash</strong>).</p>
<p>Another thing I wanted to have automatically generated based on the current available posts is an <strong>RSS</strong> feed. I personally use <strong>RSS</strong> all the time to keep up with various news, videos, etc. I think <strong>RSS</strong> is very understimated nowadays but since I use it I wanted my site to prioritize it. So the <strong>deploy-site</strong> wrapper script also generates an <strong>RSS</strong> feed and adds links to it at the top of the <strong>blogindex.html</strong> page and in the &ldquo;Recent articles&rdquo; section in the <strong>index.html</strong> page.
The <strong>RSS</strong> feed links point here: <a href="/feed">https://efym.net/feed</a> and can be accessed with any available client.</p>
<p>After all those things are done, the script rebuilds the site files using <strong>ssg</strong> then prompts me whether I&rsquo;d like to <strong>rsync</strong> the <code>dst</code> directory straight to the server hosting the website on the Internet, usually I&rsquo;ll run the script many times before I actually upload the work I&rsquo;ve done.</p>
<p>I also keep all of these files in a <strong>git</strong> repository on my <strong>Forgejo</strong> instance: <a href="https://git.efym.net/tw1zr/efym.net-ssg">git.efym.net/efym.net</a> feel free to browse, everything is Free Software under the <strong>GPLv3</strong> license.</p></article>
</main>
<footer>
<p>licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">cc by-nc-sa 4.0</a></br>
standing up for freedom </p>
</footer>
</body>
</html>

